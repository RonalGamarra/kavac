(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{BV28:function(t,e,s){"use strict";s.r(e);var n={props:{accounting_accounts:{type:Array,default:[]},entries:{type:Object,default:null}},data:function(){return{recordsAccounting:[],recordsBudget:[],rowsToDelete:[],columns:["code","debit","assets","id"],urlPrevious:"/accounting/entries",data:{date:"",reference:"",concept:"",observations:"",category:"",totDebit:0,totAssets:0,institution_id:null,currency_id:null},currency:{symbol:"",decimal_places:0},enableInput:!1,accountingOptions:[],optionIdBudget:"",type:"debit"}},created:function(){var t=this;this.table_options.headings={code:"CÓDIGO PATRIMONIAL - DENOMINACIÓN",debit:"BEDE",assets:"HABER",id:"ACCIÓN"},$("#select2").val(""),EventBus.$on("enableInput:entries-account",(function(e){t.enableInput=e.value,t.data.date=e.date,t.data.reference=e.reference,t.data.concept=e.concept,t.data.observations=e.observations,t.data.category=e.category,t.data.institution_id=e.institution_id,t.data.currency_id=e.currency_id})),EventBus.$on("change:currency",(function(e){""!=e?axios.get("/currencies/info/"+e).then((function(e){t.currency=e.data.currency})):t.currency={symbol:"",decimal_places:0}})),EventBus.$on("entries:budgetToAccount",(function(e){var s=t;axios.get("/accounting/converter/budgetToAccount/"+e).then((function(t){$("#select2").val(t.data.record.id),s.addAccountingAccount()}))}))},mounted:function(){if(this.entries){for(var t=0;t<this.entries.accounting_accounts.length;t++)this.recordsAccounting.push({id:this.entries.accounting_accounts[t].accounting_account_id,entryAccountId:this.entries.accounting_accounts[t].id,debit:this.entries.accounting_accounts[t].debit,assets:this.entries.accounting_accounts[t].assets});this.data.totDebit=parseFloat(this.entries.tot_debit),this.data.totAssets=parseFloat(this.entries.tot_assets)}},beforeDestroy:function(){EventBus.$off("enableInput:entries-account"),EventBus.$off("request:budgetToAccount")},methods:{reset:function(){EventBus.$emit("reset:accounting-entry-edit-create")},addDecimals:function(t){return parseFloat(t).toFixed(this.currency.decimal_places)},validateTotals:function(){return!(this.data.totDebit.toFixed(this.currency.decimal_places)>=0&&this.data.totAssets.toFixed(this.currency.decimal_places)>=0)},validateErrors:function(){var t=[],e=!1;return this.data.date||(t.push("El campo fecha es obligatorio."),e=!0),this.data.concept||(t.push("El campo concepto ó descripción es obligatorio."),e=!0),this.data.category||(t.push("El campo categoria es obligatorio."),e=!0),this.data.institution_id||(t.push("El campo institución es obligatorio."),e=!0),this.data.currency_id||(t.push("El tipo de moneda es obligatorio."),e=!0),this.recordsAccounting.length<1&&(t.push("No está permitido registrar asientos contables vacíos"),e=!0),this.data.totDebit!=this.data.totAssets&&(t.push("El asiento no esta balanceado, Por favor verifique."),e=!0),(this.data.totDebit<0||this.data.totAssets<0)&&(t.push("Los valores en la columna del DEBE y el HABER deben ser positivos."),e=!0),this.$refs.AccountingAccountsInForm.showAlertMessages(t),e},changeSelectinTable:function(t){""==t.id&&(t.debit=0,t.assets=0,this.CalculateTot())},cualculateLimitDecimal:function(){for(var t="0.",e=0;e<this.currency.decimal_places-1;e++)t+="0";return t+="1"},CalculateTot:function(){this.data.totDebit=0,this.data.totAssets=0;for(var t=this.recordsAccounting.length-1;t>=0;t--)if(""!=this.recordsAccounting[t].id){var e=""!=this.recordsAccounting[t].debit?this.recordsAccounting[t].debit:0,s=""!=this.recordsAccounting[t].assets?this.recordsAccounting[t].assets:0;this.recordsAccounting[t].debit=parseFloat(e).toFixed(this.currency.decimal_places),this.recordsAccounting[t].assets=parseFloat(s).toFixed(this.currency.decimal_places),this.recordsAccounting[t].debit<0||this.recordsAccounting[t].assets<0?(this.enableInput=!1,this.$refs.AccountingAccountsInForm.showAlertMessages("Los valores en la columna del DEBE y el HABER deben ser positivos.")):this.enableInput=!0,this.data.totDebit+=""!=this.recordsAccounting[t].debit?parseFloat(this.recordsAccounting[t].debit):0,this.data.totAssets+=""!=this.recordsAccounting[t].assets?parseFloat(this.recordsAccounting[t].assets):0}},addAccountingAccount:function(){if(""!=$("#select2").val())for(var t=this.accounting_accounts.length-1;t>=0;t--)if(this.accounting_accounts[t].id==$("#select2").val()){this.recordsAccounting.push({id:$("#select2").val(),entryAccountId:null,debit:0,assets:0}),$("#select2").val("");break}},createRecord:function(){null==this.entries?this.storeEntry():this.updateRecord()},storeEntry:function(){var t=this;t.validateErrors()||(t.data.tot=t.data.totDebit,t.data.tot_confirmation=t.data.totAssets,t.data.accountingAccounts=t.recordsAccounting,t.loading=!0,axios.post("/accounting/entries",t.data).then((function(e){t.loading=!1,t.showMessage("store"),setTimeout((function(){location.href=t.urlPrevious}),2e3)})).catch((function(e){var s=[];if(void 0!==e.response)for(var n in e.response.data.errors)e.response.data.errors[n]&&s.push(e.response.data.errors[n][0]);t.$refs.AccountingAccountsInForm.showAlertMessages(s),t.loading=!1})))},updateRecord:function(){var t=this;t.validateErrors()||(t.data.tot=t.data.totDebit,t.data.tot_confirmation=t.data.totAssets,t.data.accountingAccounts=t.recordsAccounting,t.data.rowsToDelete=t.rowsToDelete,t.loading=!0,axios.put("/accounting/entries/"+t.entries.id,t.data).then((function(e){t.loading=!1,t.showMessage("update"),setTimeout((function(){location.href=t.route_list}),2e3)})).catch((function(e){var s=[];if(void 0!==e.response)for(var n in e.response.data.errors)e.response.data.errors[n]&&s.push(e.response.data.errors[n][0]);t.$refs.AccountingAccountsInForm.showAlertMessages(s),t.loading=!1})))},deleteAccount:function(t,e){this.rowsToDelete.push(e),this.recordsAccounting.splice(t,1),this.CalculateTot()}}},o=s("KHd+"),a=Object(o.a)(n,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("accounting-show-errors",{ref:"AccountingAccountsInForm"}),t._v(" "),s("table",{staticClass:"table table-formulation"},[t._m(0),t._v(" "),s("tbody",[t._l(t.recordsAccounting,(function(e){return s("tr",[s("td",[s("select2",{attrs:{options:t.accounting_accounts},on:{input:function(s){return t.changeSelectinTable(e)}},model:{value:e.id,callback:function(s){t.$set(e,"id",s)},expression:"record.id"}})],1),t._v(" "),s("td",[s("input",{directives:[{name:"model",rawName:"v-model",value:e.debit,expression:"record.debit"}],staticClass:"form-control input-sm",attrs:{disabled:0!=e.assets,type:"number","data-toggle":"tooltip",step:t.cualculateLimitDecimal()},domProps:{value:e.debit},on:{change:function(e){return t.CalculateTot()},input:function(s){s.target.composing||t.$set(e,"debit",s.target.value)}}})]),t._v(" "),s("td",[s("input",{directives:[{name:"model",rawName:"v-model",value:e.assets,expression:"record.assets"}],staticClass:"form-control input-sm",attrs:{disabled:0!=e.debit,type:"number","data-toggle":"tooltip",step:t.cualculateLimitDecimal()},domProps:{value:e.assets},on:{change:function(e){return t.CalculateTot()},input:function(s){s.target.composing||t.$set(e,"assets",s.target.value)}}})]),t._v(" "),s("td",[s("div",{staticClass:"text-center"},[s("button",{staticClass:"btn btn-danger btn-xs btn-icon btn-action",attrs:{title:"Eliminar registro","data-toggle":"tooltip"},on:{click:function(s){t.deleteAccount(t.recordsAccounting.indexOf(e),e.entryAccountId)}}},[s("i",{staticClass:"fa fa-trash-o"})])])])])})),t._v(" "),t._m(1),t._v(" "),s("tr",[s("td",{attrs:{id:"helpEntriesAccountSelect"}},[s("select2",{attrs:{disabled:!t.enableInput,options:t.accounting_accounts,id:"select2"},on:{input:function(e){return t.addAccountingAccount()}}})],1),t._v(" "),s("td",{attrs:{id:"helpEntriesTotDebit"}},[s("div",{staticClass:"form-group text-center"},[t._v("Total Debe:\n                        "),s("h6",[s("span",[t._v(t._s(t.currency.symbol))]),t._v(" "),t.data.totDebit.toFixed(t.currency.decimal_places)==t.data.totAssets.toFixed(t.currency.decimal_places)&&t.data.totDebit.toFixed(t.currency.decimal_places)>=0?s("span",{staticStyle:{color:"#18ce0f"}},[s("strong",[t._v(t._s(t.addDecimals(t.data.totDebit)))])]):s("span",{staticStyle:{color:"#FF3636"}},[s("strong",[t._v(t._s(t.addDecimals(t.data.totDebit)))])])])])]),t._v(" "),s("td",{attrs:{id:"helpEntriesTotAssets"}},[s("div",{staticClass:"form-group text-center"},[t._v("Total Haber:\n                        "),s("h6",[s("span",[t._v(t._s(t.currency.symbol))]),t._v(" "),t.data.totDebit.toFixed(t.currency.decimal_places)==t.data.totAssets.toFixed(t.currency.decimal_places)&&t.data.totAssets.toFixed(t.currency.decimal_places)>=0?s("span",{staticStyle:{color:"#18ce0f"}},[s("strong",[t._v(t._s(t.addDecimals(t.data.totAssets)))])]):s("span",{staticStyle:{color:"#FF3636"}},[s("strong",[t._v(t._s(t.addDecimals(t.data.totAssets)))])])])])])])],2)]),t._v(" "),s("div",{staticClass:"card-footer text-right"},[s("buttonsDisplay",{attrs:{route_list:"/accounting/entries",display:"false"}})],1)],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("thead",[e("tr",[e("th",{staticClass:"text-uppercase",attrs:{width:"55%"}},[this._v("CÓDIGO DE CUENTA - DENOMINACIÓN")]),this._v(" "),e("th",{staticClass:"text-uppercase",attrs:{width:"20%"}},[this._v("DEBE")]),this._v(" "),e("th",{staticClass:"text-uppercase",attrs:{width:"20%"}},[this._v("HABER")]),this._v(" "),e("th",{staticClass:"text-uppercase",attrs:{width:"5%"}},[this._v("ACCIÓN")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td"),this._v(" "),e("td"),this._v(" "),e("td"),this._v(" "),e("td")])}],!1,null,null,null);e.default=a.exports},"KHd+":function(t,e,s){"use strict";function n(t,e,s,n,o,a,i,c){var r,d="function"==typeof t?t.options:t;if(e&&(d.render=e,d.staticRenderFns=s,d._compiled=!0),n&&(d.functional=!0),a&&(d._scopeId="data-v-"+a),i?(r=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),o&&o.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(i)},d._ssrRegister=r):o&&(r=c?function(){o.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:o),r)if(d.functional){d._injectStyles=r;var u=d.render;d.render=function(t,e){return r.call(e),u(t,e)}}else{var l=d.beforeCreate;d.beforeCreate=l?[].concat(l,r):[r]}return{exports:t,options:d}}s.d(e,"a",(function(){return n}))}}]);