(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{Ilyl:function(e,t,r){"use strict";r.r(t);var s={props:{record_edit:{type:Object,default:function(){return null}},date:{type:String,default:""},tax:{type:Object,default:function(){return null}},tax_units:{type:Object,default:function(){return null}},record_base_budgets:{type:Array,default:function(){return[]}},suppliers:{type:Array,default:function(){return[]}},currencies:{type:Array,default:function(){return[]}}},data:function(){return{record:{purchase_supplier_id:"",purchase_supplier_object:"",currency:null},record_items:[],columns:["purchase_requirement.code","created_at","purchase_requirement.description","purchase_requirement.fiscal_year.year","purchase_requirement.user_department.name","currency.name","id"],columns2:["requirement_code","name","quantity","unit_price","qty_price"],table2_options:{pagination:{edge:!0},highlightMatches:!0,texts:{filter:"Buscar:",filterBy:"Buscar por {column}",count:" ",first:"PRIMERO",last:"ÚLTIMO",limit:"Registros",noResults:"No existen registros"},sortIcon:{is:"fa-sort cursor-pointer",base:"fa",up:"fa-sort-up cursor-pointer",down:"fa-sort-down cursor-pointer"}},base_budget_list:[],base_budget_list_deleted:[],sub_total:0,tax_value:0,total:0,currency_id:"",purchase_supplier_id:"",convertion_list:[],load_data_edit:!1}},created:function(){this.table_options.headings={"purchase_requirement.code":"Código de requerimeinto",created_at:"Fecha","purchase_requirement.description":"Descripción","purchase_requirement.fiscal_year.year":"Año fiscal","purchase_requirement.user_department.name":"Departamento Usuario","currency.name":"Moneda",id:"Acción"},this.table_options.columnsClasses={"purchase_requirement.code":"col-xs-1 text-center",created_at:"col-xs-1 text-center","purchase_requirement.description":"col-xs-4","purchase_requirement.fiscal_year.year":"col-xs-1 text-center","purchase_requirement.user_department.name":"col-xs-2","currency.name":"col-xs-2",id:"col-xs-1"},this.table2_options.headings={requirement_code:"Código de requerimiento",name:"Nombre",quantity:"Cantidad",unit_price:"Precio unitario sin IVA",qty_price:"Cantidad * precio unitario"},this.table2_options.columnsClasses={requirement_code:"col-xs-1 text-center",name:"col-xs-5",quantity:"col-xs-2",unit_price:"col-xs-2",qty_price:"col-xs-2"},this.table2_options.filterable=[]},mounted:function(){var e=this;if(e.record_edit){e.load_data_edit=!0,e.currency_id=e.record_edit.currency_id,e.purchase_supplier_id=e.record_edit.purchase_supplier_id;for(var t=[],r=0;r<e.record_edit.relatable.length;r++)t[e.record_edit.relatable[r].purchase_requirement_item_id]=e.record_edit.relatable[r].unit_price;for(r=0;r<e.record_edit.purchase_base_budgets.length;r++)e.addToList(e.record_edit.purchase_base_budgets[r],t)}},methods:{reset:function(){this.record_items=[],this.base_budget_list=[],this.base_budget_list_deleted=[],this.record={purchase_supplier_id:"",currency:""},this.sub_total=0,this.tax_value=0,this.total=0,this.$refs.PurchaseOrderFormComponent.reset()},addDecimals:function(e){return parseFloat(e).toFixed(this.currency_decimal_places)},indexOf:function(e,t,r){for(var s=e.length-1;s>=0;s--)if(e[s].id==t)return!!r||s;return!r&&-1},recordCheck:function(e){var t=this;axios.get("/purchase/get-convertion/"+this.currency_id+"/"+e.currency_id).then(function(r){e.currency_id==t.currency_id||r.data.record?(t.convertion_list.push(r.data.record),t.addToList(e)):$("#requirement_check_"+e.id+" input:checkbox").prop("checked")&&(t.showMessage("custom","Error","danger","screen-error","Imposible realizar la conversión de "+t.record.currency.name+" a "+e.currency.name+". Revisar conversiones configuradas en el sistema."),$("#requirement_check_"+e.id+" input:checkbox").prop("checked",!1))})},addToList:function(e,t){if(-1==(s=this.indexOf(this.base_budget_list,e.id))){for(var r=0;r<e.relatable.length;r++)e.relatable[r].name=e.relatable[r].purchase_requirement_item.name,e.relatable[r].quantity=e.relatable[r].purchase_requirement_item.quantity,e.relatable[r].measurement_unit_acronym=e.relatable[r].purchase_requirement_item.measurement_unit.acronym,e.relatable[r].requirement_code=e.relatable[r].purchase_requirement_item.purchase_requirement.code,e.relatable[r].unit_price=t?t[e.relatable[r].id]:0;-1!=(s=this.indexOf(this.base_budget_list_deleted,e.id))&&this.base_budget_list_deleted.splice(s,1),this.base_budget_list.push(e),this.record_items=this.record_items.concat(e.relatable)}else{var s,i=this.base_budget_list.splice(s,1)[0];-1==(s=this.indexOf(this.base_budget_list_deleted,i.id))&&this.base_budget_list_deleted.push(i);for(r=0;r<e.relatable.length;r++)for(var a=0;a<this.record_items.length;a++)if(this.record_items[a].id==e.relatable[r].id){delete this.record_items[a].qty_price,this.record_items.splice(a,1);break}}this.CalculateTot()},CalculateTot:function(e,t){var r=this;r.sub_total=0,r.tax_value=0;for(var s=r.record_items.length-1;s>=0;s--){var i=r.record_items[s];i.qty_price=i.quantity*i.unit_price,r.sub_total+=i.qty_price}r.tax_value=r.sub_total*(parseFloat(r.tax.percentage)/100),r.total=r.sub_total+r.tax_value},CalculateQtyPrice:function(e){return e?e.toFixed(this.record.currency?this.currency_decimal_places:""):0},cualculateLimitDecimal:function(){var e="0.";if(this.currency)for(var t=0;t<this.currency.decimal_places-1;t++)e+="0";return e+="1"},createRecord:function(){var e=this,t=this,r=new FormData;r.append("purchase_supplier_id",this.purchase_supplier_id),r.append("currency_id",this.currency_id),r.append("subtotal",this.sub_total),r.append("record_list",JSON.stringify(this.base_budget_list)),t.loading=!0,this.record_edit?(r.append("list_to_delete",JSON.stringify(this.base_budget_list_deleted)),axios.post("/purchase/quotation/"+this.record_edit.id,r,{headers:{"Content-Type":"multipart/form-data"}}).then(function(r){t.showMessage("update"),t.loading=!1,location.href=e.route_list}).catch(function(e){if(void 0!==e.response&&(422==e.response.status||500==e.response.status))for(var r in e.response.data.errors)t.showMessage("custom","Error","danger","screen-error",e.response.data.errors[r][0]);t.loading=!1})):axios.post("/purchase/quotation",r,{headers:{"Content-Type":"multipart/form-data"}}).then(function(r){t.showMessage("store"),t.loading=!1,location.href=e.route_list}).catch(function(e){if(void 0!==e.response&&(422==e.response.status||500==e.response.status))for(var r in e.response.data.errors)t.showMessage("custom","Error","danger","screen-error",e.response.data.errors[r][0]);t.loading=!1})}},watch:{currency_id:function(e,t){var r=this;e==t||this.load_data_edit?this.load_data_edit=!1:(this.record_items=[],this.base_budget_list_deleted=[],this.base_budget_list.length>0&&(this.base_budget_list_deleted=this.base_budget_list),this.base_budget_list=[],this.sub_total=0,this.tax_value=0,this.total=0),e&&axios.get("/currencies/info/"+e).then(function(e){r.record.currency=e.data.currency})},purchase_supplier_id:function(e){var t=this;e&&axios.get("/purchase/get-purchase-supplier-object/"+e).then(function(r){t.record.purchase_supplier_object=r.data,t.record.purchase_supplier_id=e})}},computed:{currency_symbol:function(){return this.record.currency?this.record.currency.symbol:""},currency_decimal_places:function(){if(this.record.currency)return this.record.currency.decimal_places},currency:function(){return this.record.currency?this.record.currency:null},getRecordItems:function(){return this.record_items}}},i=r("KHd+"),a=Object(i.a)(s,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",[r("purchase-show-errors",{attrs:{refs:"PurchaseOrderFormComponent"}}),e._v(" "),r("div",{staticClass:"row"},[r("div",{staticClass:"col-3"},[r("div",{staticClass:"form-group is-required"},[r("label",{staticClass:"control-label",attrs:{for:"suppliers"}},[e._v("Proveedor")]),r("br"),e._v(" "),r("select2",{attrs:{options:e.suppliers,id:"suppliers"},model:{value:e.purchase_supplier_id,callback:function(t){e.purchase_supplier_id=t},expression:"purchase_supplier_id"}})],1)]),e._v(" "),r("div",{staticClass:"col-3"},[r("div",{staticClass:"form-group"},[r("label",{staticClass:"control-label",attrs:{for:"currencies"}},[e._v("Tipo de proveedor")]),r("br"),e._v(" "),e.record.purchase_supplier_object?r("div",["S"==e.record.purchase_supplier_object.type?r("div",[r("strong",[e._v("Servicios / "+e._s(e.record.purchase_supplier_object.name))])]):"O"==e.record.purchase_supplier_object.type?r("div",[r("strong",[e._v("Obras / "+e._s(e.record.purchase_supplier_object.name))])]):"B"==e.record.purchase_supplier_object.type?r("div",[r("strong",[e._v("Bienes / "+e._s(e.record.purchase_supplier_object.name))])]):e._e()]):e._e()])]),e._v(" "),r("div",{staticClass:"col-3"},[r("div",{staticClass:"form-group is-required"},[r("label",{staticClass:"control-label",attrs:{for:"currencies"}},[e._v("Tipo de moneda")]),r("br"),e._v(" "),r("select2",{attrs:{options:e.currencies,id:"currencies"},model:{value:e.currency_id,callback:function(t){e.currency_id=t},expression:"currency_id"}})],1)]),e._v(" "),r("div",{staticClass:"col-12 row"},[r("div",{staticClass:"col-3"},[r("label",{attrs:{for:"acta_inicio"}},[e._v("Acta de inicio (inhabilitado temporalmente)")]),e._v(" "),r("label",{staticClass:"custom-control"},[r("button",{staticClass:"btn btn-sm btn-info btn-import mt-4",attrs:{type:"button","data-toggle":"tooltip",title:"Presione para subir el archivo del documento.",disabled:""},on:{click:function(t){return e.setFile("acta_inicio")}}},[r("i",{staticClass:"fa fa-upload"})]),e._v(" "),r("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"acta_inicio"},on:{change:function(t){return e.uploadFile("acta_inicio")}}}),e._v(" "),e._m(0)])]),e._v(" "),r("div",{staticClass:"col-3"},[r("label",{attrs:{for:"invitation_bussiness"}},[e._v("Invitación de la empresa (inhabilitado temporalmente)")]),e._v(" "),r("label",{staticClass:"custom-control"},[r("button",{staticClass:"btn btn-sm btn-info btn-import",attrs:{type:"button","data-toggle":"tooltip",title:"Presione para subir el archivo del documento.",disabled:""},on:{click:function(t){return e.setFile("invitation_bussiness")}}},[r("i",{staticClass:"fa fa-upload"})]),e._v(" "),r("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"invitation_bussiness"},on:{change:function(t){return e.uploadFile("invitation_bussiness")}}}),e._v(" "),e._m(1)])]),e._v(" "),r("div",{staticClass:"col-3"},[r("label",{attrs:{for:"invitation_bussiness"}},[e._v("Proforma / Cotización (inhabilitado temporalmente)")]),e._v(" "),r("label",{staticClass:"custom-control"},[r("button",{staticClass:"btn btn-sm btn-info btn-import",attrs:{type:"button","data-toggle":"tooltip",title:"Presione para subir el archivo del documento.",disabled:""},on:{click:function(t){return e.setFile("invitation_bussiness")}}},[r("i",{staticClass:"fa fa-upload"})]),e._v(" "),r("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"invitation_bussiness"},on:{change:function(t){return e.uploadFile("invitation_bussiness")}}}),e._v(" "),e._m(2)])])]),e._v(" "),e._m(3),e._v(" "),e._m(4),e._v(" "),r("div",{staticClass:"col-12"},[r("v-client-table",{attrs:{columns:e.columns,data:e.record_base_budgets,options:e.table_options},scopedSlots:e._u([{key:"requirement_status",fn:function(t){return r("div",{staticClass:"text-center"},[r("div",{staticClass:"d-inline-flex"},[r("span",{directives:[{name:"show",rawName:"v-show",value:"PROCESSED"==t.row.requirement_status,expression:"props.row.requirement_status == 'PROCESSED'"}],staticClass:"badge badge-info"},[r("strong",[e._v("PROCESADO")])])])])}},{key:"id",fn:function(t){return r("div",{staticClass:"text-center"},[e.record.currency?r("div",{staticClass:"feature-list-content-left mr-2"},[r("label",{staticClass:"custom-control custom-checkbox"},[r("p-check",{staticClass:"p-icon p-smooth p-plain p-curve",attrs:{color:"primary-o",value:"_"+t.row.id,id:"requirement_check_"+t.row.id,checked:e.indexOf(e.base_budget_list,t.row.id,!0)},on:{change:function(r){return e.recordCheck(t.row)}}},[r("i",{staticClass:"icon fa fa-check",attrs:{slot:"extra"},slot:"extra"})])],1)]):e._e()])}}])})],1),e._v(" "),r("div",{staticClass:"col-12"},[r("v-client-table",{attrs:{columns:e.columns2,data:e.record_items,options:e.table2_options},scopedSlots:e._u([{key:"quantity",fn:function(t){return r("div",{},[r("h6",{attrs:{align:"left"}},[e._v(e._s(t.row.quantity)+" "+e._s(t.row.measurement_unit_acronym))])])}},{key:"unit_price",fn:function(t){return r("div",{},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.record_items[t.index-1].unit_price,expression:"record_items[props.index-1].unit_price"}],staticClass:"form-control",attrs:{type:"number",step:e.cualculateLimitDecimal()},domProps:{value:e.record_items[t.index-1].unit_price},on:{input:[function(r){r.target.composing||e.$set(e.record_items[t.index-1],"unit_price",r.target.value)},function(r){return e.CalculateTot(e.record_items[t.index-1],t.index-1)}]}})])}},{key:"qty_price",fn:function(t){return r("div",{},[r("h6",{attrs:{align:"right"}},[e._v(e._s(e.CalculateQtyPrice(e.record_items[t.index-1].qty_price)))])])}}])})],1),e._v(" "),e.record_items.length>0?r("div",{staticClass:"col-12"},[r("div",{staticClass:"VueTables VueTables--client",staticStyle:{"margin-top":"-1rem"}},[r("div",{staticClass:"table-responsive"},[r("table",{staticClass:"VueTables__table table table-striped table-bordered table-hover"},[r("tbody",[r("tr",[r("td",{staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0",width:"8.2%"}}),e._v(" "),r("td",{staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0",width:"25%"}}),e._v(" "),r("td",{staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0",width:"16.65%"}}),e._v(" "),r("td",{staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0",width:"16.75%"}}),e._v(" "),r("td",{staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0",width:"16.75%"}},[r("h6",{attrs:{align:"right"}},[e._v("SUB-TOTAL "+e._s(e.currency_symbol))])]),e._v(" "),r("td",{staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0",width:"20%"}},[r("h6",{attrs:{align:"right"}},[e._v(e._s(e.sub_total.toFixed(e.record.currency?e.currency_decimal_places:"")))])])]),e._v(" "),r("tr",[r("td",{staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0",width:"8.2%"}}),e._v(" "),r("td",{staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0",width:"25%"}}),e._v(" "),r("td",{staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0",width:"16.6%"}}),e._v(" "),r("td",{staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0",width:"16.75%"}}),e._v(" "),r("td",{staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0",width:"16.75%"}},[r("h6",{attrs:{align:"right"}},[e._v(e._s(e.tax?e.tax.percentage:"")+" % IVA "+e._s(e.currency_symbol))])]),e._v(" "),r("td",{staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0",width:"20%"}},[r("h6",{attrs:{align:"right"}},[e._v(e._s(e.tax_value.toFixed(e.record.currency?e.currency_decimal_places:"")))])])]),e._v(" "),r("tr",[r("td",{staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0",width:"8.2%"}}),e._v(" "),r("td",{staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0",width:"25%"}}),e._v(" "),r("td",{staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0",width:"16.6%"}}),e._v(" "),r("td",{staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0",width:"16.75%"}}),e._v(" "),r("td",{staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0",width:"16.75%"}},[r("h6",{attrs:{align:"right"}},[e._v("TOTAL "+e._s(e.currency_symbol))])]),e._v(" "),r("td",{staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0",width:"20%"}},[r("h6",{attrs:{align:"right"}},[e._v(e._s(e.total.toFixed(e.record.currency?e.currency_decimal_places:"")))])])])])])])])]):e._e()]),e._v(" "),r("div",{staticClass:"card-footer text-right"},[r("buttonsDisplay",{attrs:{route_list:"/purchese/purchase_order",display:"false"}})],1)],1)},[function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"badge badge-success",staticStyle:{display:"none"},attrs:{id:"status_acta_inicio"}},[t("strong",[this._v("Documento Cargado.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"badge badge-success",staticStyle:{display:"none"},attrs:{id:"status_invitation_bussiness"}},[t("strong",[this._v("Documento Cargado.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"badge badge-success",staticStyle:{display:"none"},attrs:{id:"status_invitation_bussiness"}},[t("strong",[this._v("Documento Cargado.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"col-12"},[t("hr")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"col-12"},[t("h6",{staticClass:"card-title"},[this._v("Lista de presupuestos base en espera de cotización")])])}],!1,null,null,null);t.default=a.exports},"KHd+":function(e,t,r){"use strict";function s(e,t,r,s,i,a,n,c){var o,d="function"==typeof e?e.options:e;if(t&&(d.render=t,d.staticRenderFns=r,d._compiled=!0),s&&(d.functional=!0),a&&(d._scopeId="data-v-"+a),n?(o=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(n)},d._ssrRegister=o):i&&(o=c?function(){i.call(this,this.$root.$options.shadowRoot)}:i),o)if(d.functional){d._injectStyles=o;var l=d.render;d.render=function(e,t){return o.call(t),l(e,t)}}else{var u=d.beforeCreate;d.beforeCreate=u?[].concat(u,o):[o]}return{exports:e,options:d}}r.d(t,"a",function(){return s})}}]);