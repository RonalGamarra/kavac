(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{AsVx:function(e,t,s){"use strict";s.r(t);var r={props:{records:{type:Array,default:function(){return[]}},currencies:{type:Array,default:function(){return[]}},record_tax:{type:Object,default:function(){return null}},base_budget_edit:{type:Object,default:function(){return null}}},data:function(){return{record_items:[],requirement_list:[],requirement_list_deleted:[],columns:["code","description","fiscal_year.year","contrating_department.name","user_department.name","purchase_supplier_type.name","requirement_status"],currency_id:"",currency:null,sub_total:0,tax:0,total:0,requirement_checked:[]}},methods:{reset:function(){},createRecord:function(){var e=this;if(this.$refs.PurchaseBaseBudgetComponent.reset(),!this.record_tax)return this.$refs.PurchaseBaseBudgetComponent.showAlertMessages("Debe configurar el IVA en el sistema."),void this.showMessage("custom","Error","danger","screen-error","Debe configurar el IVA en el sistema.");if(!this.currency_id)return this.$refs.PurchaseBaseBudgetComponent.showAlertMessages("Debe seleccionar un tipo de moneda."),void this.showMessage("custom","Error","danger","screen-error","Debe seleccionar un tipo de moneda.");for(var t=0;t<this.record_items.length;t++){if(!this.record_items[t].qty_price)return this.$refs.PurchaseBaseBudgetComponent.showAlertMessages("El precio unitario de los registros son obligatorios."),void this.showMessage("custom","Error","danger","screen-error","El precio unitario de los registros son obligatorios.");this.record_items[t].qty_price=this.record_items[t].qty_price.toFixed(this.currency?this.currency.decimal_places:"")}this.loading=!0,this.base_budget_edit?axios.put("/purchase/base_budget/"+this.base_budget_edit.id,{list:this.requirement_list,list_to_delete:this.requirement_list_deleted,currency_id:this.currency_id,subtotal:this.sub_total,tax_id:this.record_tax.id}).then(function(t){e.loading=!1,e.showMessage("update"),setTimeout(function(){location.href="/purchase/requirements"},2e3)}).catch(function(t){e.loading=!1,e.$refs.PurchaseBaseBudgetComponent.reset();var s=[];if(void 0!==t.response)for(var r in t.response.data.errors)t.response.data.errors[r]&&(s.push(t.response.data.errors[r][0]),e.showMessage("custom","Error","danger","screen-error",t.response.data.errors[r][0]));e.$refs.PurchaseBaseBudgetComponent.showAlertMessages(s)}):axios.post("/purchase/base_budget",{list:this.requirement_list,currency_id:this.currency_id,subtotal:this.sub_total,tax_id:this.record_tax.id}).then(function(t){e.loading=!1,e.showMessage("store"),setTimeout(function(){location.href="/purchase/requirements"},2e3)}).catch(function(t){e.loading=!1,e.$refs.PurchaseBaseBudgetComponent.reset();var s=[];if(void 0!==t.response)for(var r in t.response.data.errors)t.response.data.errors[r]&&(s.push(t.response.data.errors[r][0]),e.showMessage("custom","Error","danger","screen-error",t.response.data.errors[r][0]));e.$refs.PurchaseBaseBudgetComponent.showAlertMessages(s)})},CalculateQtyPrice:function(e){return e?e.toFixed(this.currency?this.currency.decimal_places:""):0},CalculateTot:function(){this.sub_total=0,this.tax=0;for(var e=this.record_items.length-1;e>=0;e--){var t=this.record_items[e];t.qty_price=t.quantity*t.unit_price,this.sub_total+=t.qty_price}this.tax=this.sub_total*(parseFloat(this.record_tax.percentage)/100),this.total=this.sub_total+this.tax},cualculateLimitDecimal:function(){var e="0.";if(this.currency)for(var t=0;t<this.currency.decimal_places-1;t++)e+="0";return e+="1"}},created:function(){this.table_options.headings={code:"Código",description:"Descripción","fiscal_year.year":"Año fiscal","contrating_department.name":"Departamento contatante","user_department.name":"Departamento Usuario","purchase_supplier_type.name":"Tipo de Proveedor",requirement_status:"Estado"},this.table_options.columnsClasses={code:"col-xs-1 text-center",description:"col-xs-3","fiscal_year.year":"col-xs-1 text-center","contrating_department.name":"col-xs-2","user_department.name":"col-xs-2","purchase_supplier_type.name":"col-xs-2",requirement_status:"col-xs-1"}},mounted:function(){var e=this;if(e.record_tax||e.$refs.PurchaseBaseBudgetComponent.showAlertMessages("Debe configurar el IVA en el sistema."),e.base_budget_edit){e.currency_id=e.base_budget_edit.currency_id;for(var t=[],s=0;s<e.base_budget_edit.relatable.length;s++)t[e.base_budget_edit.relatable[s].purchase_requirement_item_id]=e.base_budget_edit.relatable[s].unit_price;var r=e.base_budget_edit.purchase_requirement;e.requirement_list.push(r);for(var a=r.purchase_requirement_items,i=0;i<a.length;i++)a[i].requirement_code=r.code,a[i].unit_price=t&&t[a[i].id]?t[a[i].id]:0,a[i].qty_price=a[i].quantity*a[i].unit_price,e.record_items=e.record_items.concat(a[i]);e.CalculateTot()}},watch:{currency_id:function(e){var t=this;e&&axios.get("/currencies/info/"+e).then(function(e){t.currency=e.data.currency,t.CalculateTot()})}},computed:{currency_symbol:function(){return this.currency?this.currency.symbol:""}}},a=s("KHd+"),i=Object(a.a)(r,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",[s("div",{staticClass:"form-horizontal"},[s("purchase-show-errors",{ref:"PurchaseBaseBudgetComponent"}),e._v(" "),s("div",{staticClass:"card-body"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-3"},[s("div",{staticClass:"form-group is-required"},[s("label",{staticClass:"control-label"},[e._v("Tipo de moneda\n                        ")]),e._v(" "),s("select2",{attrs:{options:e.currencies,tabindex:"1"},model:{value:e.currency_id,callback:function(t){e.currency_id=t},expression:"currency_id"}})],1)]),e._v(" "),s("div",{staticClass:"col-12"},[s("v-client-table",{staticClass:"row",attrs:{columns:e.columns,data:e.records,options:e.table_options},scopedSlots:e._u([{key:"requirement_status",fn:function(t){return s("div",{staticClass:"text-center"},[s("div",{staticClass:"d-inline-flex"},[s("span",{directives:[{name:"show",rawName:"v-show",value:"WAIT"==t.row.requirement_status,expression:"props.row.requirement_status == 'WAIT'"}],staticClass:"badge badge-danger"},[s("strong",[e._v("EN ESPERA")])]),e._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:"PROCESSED"==t.row.requirement_status,expression:"props.row.requirement_status == 'PROCESSED'"}],staticClass:"badge badge-info"},[s("strong",[e._v("PROCESADO")])]),e._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:"BOUGHT"==t.row.requirement_status,expression:"props.row.requirement_status == 'BOUGHT'"}],staticClass:"badge badge-success"},[s("strong",[e._v("COMPRADO ")])])])])}}])})],1)])])],1),e._v(" "),s("hr"),e._v(" "),s("div",{staticClass:"form-horizontal"},[s("div",{staticClass:"card-body"},[s("table",{staticClass:"table table-striped table-hover"},[e._m(0),e._v(" "),s("tbody",[e._l(e.record_items,function(t){return s("tr",{staticClass:"row"},[s("td",{staticClass:"col-1",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[e._v("\n                            "+e._s(t.requirement_code)+"\n                        ")]),e._v(" "),s("td",{staticClass:"col-3",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[e._v("\n                            "+e._s(t.name)+"\n                        ")]),e._v(" "),s("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[e._v("\n                            "+e._s(t.quantity)+"\n                        ")]),e._v(" "),s("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[e._v("\n                            "+e._s(t.measurement_unit.acronym)+"\n                        ")]),e._v(" "),s("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.pivot_purchase?t.pivot_purchase.unit_price:t.unit_price,expression:"(varr.pivot_purchase)?varr.pivot_purchase.unit_price:varr.unit_price"}],staticClass:"form-control",attrs:{type:"number",disabled:!e.currency_id,step:e.cualculateLimitDecimal()},domProps:{value:t.pivot_purchase?t.pivot_purchase.unit_price:t.unit_price},on:{input:[function(s){s.target.composing||e.$set(t.pivot_purchase?t.pivot_purchase.unit_price:t,"unit_price",s.target.value)},e.CalculateTot]}})]),e._v(" "),s("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[s("h6",{attrs:{align:"right"}},[e._v(e._s(e.CalculateQtyPrice(t.qty_price)))])])])}),e._v(" "),s("tr",{staticClass:"row"},[s("td",{staticClass:"col-8",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}}),e._v(" "),s("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[s("h6",{attrs:{align:"right"}},[e._v("SUB TOTAL "+e._s(e.currency_symbol))])]),e._v(" "),s("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[s("h6",{attrs:{align:"right"}},[e._v(e._s(e.sub_total.toFixed(e.currency?e.currency.decimal_places:"")))])])]),e._v(" "),s("tr",{staticClass:"row"},[s("td",{staticClass:"col-8",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}}),e._v(" "),s("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[s("h6",{attrs:{align:"right"}},[e._v(e._s(e.record_tax?e.record_tax.percentage:"")+" % IVA "+e._s(e.currency_symbol))])]),e._v(" "),s("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[s("h6",{attrs:{align:"right"}},[e._v(e._s(e.tax.toFixed(e.currency?e.currency.decimal_places:"")))])])]),e._v(" "),s("tr",{staticClass:"row"},[s("td",{staticClass:"col-8",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}}),e._v(" "),s("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[s("h6",{attrs:{align:"right"}},[e._v("TOTAL "+e._s(e.currency_symbol))])]),e._v(" "),s("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[s("h6",{attrs:{align:"right"}},[e._v(e._s(e.total.toFixed(e.currency?e.currency.decimal_places:"")))])])])],2)]),e._v(" "),s("div",{staticClass:"card-footer text-right"},[s("buttonsDisplay",{attrs:{route_list:"/purchese/requirements",display:"false"}})],1)])])])},[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("thead",[s("tr",{staticClass:"row"},[s("th",{staticClass:"col-1",staticStyle:{border:"1px solid #dee2e6",position:"relative"},attrs:{tabindex:"0"}},[e._v("Código de requerimiento")]),e._v(" "),s("th",{staticClass:"col-3",staticStyle:{border:"1px solid #dee2e6",position:"relative"},attrs:{tabindex:"0"}},[e._v("Nombre")]),e._v(" "),s("th",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6",position:"relative"},attrs:{tabindex:"0"}},[e._v("Cantidad")]),e._v(" "),s("th",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6",position:"relative"},attrs:{tabindex:"0"}},[e._v("Unidad de medida")]),e._v(" "),s("th",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6",position:"relative"},attrs:{tabindex:"0"}},[e._v("Precio Unitario sin IVA")]),e._v(" "),s("th",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6",position:"relative"},attrs:{tabindex:"0"}},[e._v("cantidad * Precio unitario")])])])}],!1,null,null,null);t.default=i.exports},"KHd+":function(e,t,s){"use strict";function r(e,t,s,r,a,i,o,n){var c,d="function"==typeof e?e.options:e;if(t&&(d.render=t,d.staticRenderFns=s,d._compiled=!0),r&&(d.functional=!0),i&&(d._scopeId="data-v-"+i),o?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),a&&a.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},d._ssrRegister=c):a&&(c=n?function(){a.call(this,this.$root.$options.shadowRoot)}:a),c)if(d.functional){d._injectStyles=c;var l=d.render;d.render=function(e,t){return c.call(t),l(e,t)}}else{var u=d.beforeCreate;d.beforeCreate=u?[].concat(u,c):[c]}return{exports:e,options:d}}s.d(t,"a",function(){return r})}}]);