(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{AsVx:function(e,t,r){"use strict";r.r(t);var s={props:{records:{type:Array,default:function(){return[]}},currencies:{type:Array,default:function(){return[]}},record_tax:{type:Object,default:function(){return null}},base_budget_edit:{type:Object,default:function(){return null}}},data:function(){return{record_items:[],requirement_list:[],requirement_list_deleted:[],columns:["code","description","fiscal_year.year","contrating_department.name","user_department.name","purchase_supplier_type.name","requirement_status"],currency_id:"",currency:null,sub_total:0,tax:0,total:0,requirement_checked:[]}},methods:{reset:function(){},createRecord:function(){var e=this;if(e.showMessageError(e.$refs.PurchaseBaseBudgetComponent,null,!0),!e.record_tax)return e.showMessageError(e.$refs.PurchaseBaseBudgetComponent,"Debe configurar el IVA en el sistema."),void e.showMessage("custom","Error","danger","screen-error","Debe configurar el IVA en el sistema.");if(!e.currency_id)return e.showMessageError(e.$refs.PurchaseBaseBudgetComponent,"Debe seleccionar un tipo de moneda."),void e.showMessage("custom","Error","danger","screen-error","Debe seleccionar un tipo de moneda.");for(var t=0;t<e.record_items.length;t++){if(!e.record_items[t].qty_price)return e.showMessageError(e.$refs.PurchaseBaseBudgetComponent,"El precio unitario de los registros son obligatorios."),void e.showMessage("custom","Error","danger","screen-error","El precio unitario de los registros son obligatorios.");e.record_items[t].qty_price=e.record_items[t].qty_price.toFixed(e.currency?e.currency.decimal_places:"")}e.loading=!0,e.base_budget_edit?axios.put("/purchase/base_budget/"+e.base_budget_edit.id,{list:e.requirement_list,list_to_delete:e.requirement_list_deleted,currency_id:e.currency_id,subtotal:e.sub_total,tax_id:e.record_tax.id}).then(function(t){e.loading=!1,e.showMessage("update"),setTimeout(function(){location.href="/purchase/requirements"},2e3)}).catch(function(t){e.loading=!1,e.showMessageError(e.$refs.PurchaseBaseBudgetComponent,null,!0);var r=[];if(void 0!==t.response)for(var s in t.response.data.errors)t.response.data.errors[s]&&(r.push(t.response.data.errors[s][0]),e.showMessage("custom","Error","danger","screen-error",t.response.data.errors[s][0]));e.showMessageError(e.$refs.PurchaseBaseBudgetComponent,r)}):axios.post("/purchase/base_budget",{list:e.requirement_list,currency_id:e.currency_id,subtotal:e.sub_total,tax_id:e.record_tax.id}).then(function(t){e.loading=!1,e.showMessage("store"),setTimeout(function(){location.href="/purchase/requirements"},2e3)}).catch(function(t){e.loading=!1,e.showMessageError(e.$refs.PurchaseBaseBudgetComponent,null,!0);var r=[];if(void 0!==t.response)for(var s in t.response.data.errors)t.response.data.errors[s]&&(r.push(t.response.data.errors[s][0]),e.showMessage("custom","Error","danger","screen-error",t.response.data.errors[s][0]));e.showMessageError(e.$refs.PurchaseBaseBudgetComponent,r)})},CalculateQtyPrice:function(e){return e?e.toFixed(this.currency?this.currency.decimal_places:""):0},CalculateTot:function(){this.sub_total=0,this.tax=0;for(var e=this.record_items.length-1;e>=0;e--){var t=this.record_items[e];t.qty_price=t.quantity*t.unit_price,this.sub_total+=t.qty_price}this.tax=this.sub_total*(parseFloat(this.record_tax.percentage)/100),this.total=this.sub_total+this.tax},cualculateLimitDecimal:function(){var e="0.";if(this.currency)for(var t=0;t<this.currency.decimal_places-1;t++)e+="0";return e+="1"}},created:function(){this.table_options.headings={code:"Código",description:"Descripción","fiscal_year.year":"Año fiscal","contrating_department.name":"Departamento contatante","user_department.name":"Departamento Usuario","purchase_supplier_type.name":"Tipo de Proveedor",requirement_status:"Estado"},this.table_options.columnsClasses={code:"col-xs-1 text-center",description:"col-xs-3","fiscal_year.year":"col-xs-1 text-center","contrating_department.name":"col-xs-2","user_department.name":"col-xs-2","purchase_supplier_type.name":"col-xs-2",requirement_status:"col-xs-1"}},mounted:function(){var e=this;if(e.record_tax||e.showMessageError(e.$refs.PurchaseBaseBudgetComponent,"Debe configurar el IVA en el sistema."),e.base_budget_edit){e.currency_id=e.base_budget_edit.currency_id;for(var t=[],r=0;r<e.base_budget_edit.relatable.length;r++)t[e.base_budget_edit.relatable[r].purchase_requirement_item_id]=e.base_budget_edit.relatable[r].unit_price;var s=e.base_budget_edit.purchase_requirement;e.requirement_list.push(s);for(var a=s.purchase_requirement_items,i=0;i<a.length;i++)a[i].requirement_code=s.code,a[i].unit_price=t&&t[a[i].id]?t[a[i].id]:0,a[i].qty_price=a[i].quantity*a[i].unit_price,e.record_items=e.record_items.concat(a[i]);e.CalculateTot()}},watch:{currency_id:function(e){var t=this;e&&axios.get("/currencies/info/"+e).then(function(e){t.currency=e.data.currency,t.CalculateTot()})}},computed:{currency_symbol:function(){return this.currency?this.currency.symbol:""}}},a=r("KHd+"),i=Object(a.a)(s,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",[r("div",{staticClass:"form-horizontal"},[r("purchase-show-errors",{attrs:{refs:"PurchaseBaseBudgetComponent"}}),e._v(" "),r("div",{staticClass:"card-body"},[r("div",{staticClass:"row"},[r("div",{staticClass:"col-3"},[r("div",{staticClass:"form-group is-required"},[r("label",{staticClass:"control-label"},[e._v("Tipo de moneda\n                        ")]),e._v(" "),r("select2",{attrs:{options:e.currencies,tabindex:"1"},model:{value:e.currency_id,callback:function(t){e.currency_id=t},expression:"currency_id"}})],1)]),e._v(" "),r("div",{staticClass:"col-12"},[r("v-client-table",{staticClass:"row",attrs:{columns:e.columns,data:e.records,options:e.table_options},scopedSlots:e._u([{key:"requirement_status",fn:function(t){return r("div",{staticClass:"text-center"},[r("div",{staticClass:"d-inline-flex"},[r("span",{directives:[{name:"show",rawName:"v-show",value:"WAIT"==t.row.requirement_status,expression:"props.row.requirement_status == 'WAIT'"}],staticClass:"badge badge-danger"},[r("strong",[e._v("EN ESPERA")])]),e._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:"PROCESSED"==t.row.requirement_status,expression:"props.row.requirement_status == 'PROCESSED'"}],staticClass:"badge badge-info"},[r("strong",[e._v("PROCESADO")])]),e._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:"BOUGHT"==t.row.requirement_status,expression:"props.row.requirement_status == 'BOUGHT'"}],staticClass:"badge badge-success"},[r("strong",[e._v("COMPRADO ")])])])])}}])})],1)])])],1),e._v(" "),r("hr"),e._v(" "),r("div",{staticClass:"form-horizontal"},[r("div",{staticClass:"card-body"},[r("table",{staticClass:"table table-striped table-hover"},[e._m(0),e._v(" "),r("tbody",[e._l(e.record_items,function(t){return r("tr",{staticClass:"row"},[r("td",{staticClass:"col-1",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[e._v("\n                            "+e._s(t.requirement_code)+"\n                        ")]),e._v(" "),r("td",{staticClass:"col-3",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[e._v("\n                            "+e._s(t.name)+"\n                        ")]),e._v(" "),r("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[e._v("\n                            "+e._s(t.quantity)+"\n                        ")]),e._v(" "),r("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[e._v("\n                            "+e._s(t.measurement_unit.acronym)+"\n                        ")]),e._v(" "),r("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.pivot_purchase?t.pivot_purchase.unit_price:t.unit_price,expression:"(varr.pivot_purchase)?varr.pivot_purchase.unit_price:varr.unit_price"}],staticClass:"form-control",attrs:{type:"number",disabled:!e.currency_id,step:e.cualculateLimitDecimal()},domProps:{value:t.pivot_purchase?t.pivot_purchase.unit_price:t.unit_price},on:{input:[function(r){r.target.composing||e.$set(t.pivot_purchase?t.pivot_purchase.unit_price:t,"unit_price",r.target.value)},e.CalculateTot]}})]),e._v(" "),r("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[r("h6",{attrs:{align:"right"}},[e._v(e._s(e.CalculateQtyPrice(t.qty_price)))])])])}),e._v(" "),r("tr",{staticClass:"row"},[r("td",{staticClass:"col-8",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}}),e._v(" "),r("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[r("h6",{attrs:{align:"right"}},[e._v("SUB TOTAL "+e._s(e.currency_symbol))])]),e._v(" "),r("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[r("h6",{attrs:{align:"right"}},[e._v(e._s(e.sub_total.toFixed(e.currency?e.currency.decimal_places:"")))])])]),e._v(" "),r("tr",{staticClass:"row"},[r("td",{staticClass:"col-8",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}}),e._v(" "),r("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[r("h6",{attrs:{align:"right"}},[e._v(e._s(e.record_tax?e.record_tax.percentage:"")+" % IVA "+e._s(e.currency_symbol))])]),e._v(" "),r("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[r("h6",{attrs:{align:"right"}},[e._v(e._s(e.tax.toFixed(e.currency?e.currency.decimal_places:"")))])])]),e._v(" "),r("tr",{staticClass:"row"},[r("td",{staticClass:"col-8",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}}),e._v(" "),r("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[r("h6",{attrs:{align:"right"}},[e._v("TOTAL "+e._s(e.currency_symbol))])]),e._v(" "),r("td",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6"},attrs:{tabindex:"0"}},[r("h6",{attrs:{align:"right"}},[e._v(e._s(e.total.toFixed(e.currency?e.currency.decimal_places:"")))])])])],2)]),e._v(" "),r("div",{staticClass:"card-footer text-right"},[r("buttonsDisplay",{attrs:{route_list:"/purchese/requirements",display:"false"}})],1)])])])},[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("thead",[r("tr",{staticClass:"row"},[r("th",{staticClass:"col-1",staticStyle:{border:"1px solid #dee2e6",position:"relative"},attrs:{tabindex:"0"}},[e._v("Código de requerimiento")]),e._v(" "),r("th",{staticClass:"col-3",staticStyle:{border:"1px solid #dee2e6",position:"relative"},attrs:{tabindex:"0"}},[e._v("Nombre")]),e._v(" "),r("th",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6",position:"relative"},attrs:{tabindex:"0"}},[e._v("Cantidad")]),e._v(" "),r("th",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6",position:"relative"},attrs:{tabindex:"0"}},[e._v("Unidad de medida")]),e._v(" "),r("th",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6",position:"relative"},attrs:{tabindex:"0"}},[e._v("Precio Unitario sin IVA")]),e._v(" "),r("th",{staticClass:"col-2",staticStyle:{border:"1px solid #dee2e6",position:"relative"},attrs:{tabindex:"0"}},[e._v("cantidad * Precio unitario")])])])}],!1,null,null,null);t.default=i.exports},"KHd+":function(e,t,r){"use strict";function s(e,t,r,s,a,i,o,n){var c,d="function"==typeof e?e.options:e;if(t&&(d.render=t,d.staticRenderFns=r,d._compiled=!0),s&&(d.functional=!0),i&&(d._scopeId="data-v-"+i),o?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),a&&a.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},d._ssrRegister=c):a&&(c=n?function(){a.call(this,this.$root.$options.shadowRoot)}:a),c)if(d.functional){d._injectStyles=c;var l=d.render;d.render=function(e,t){return c.call(t),l(e,t)}}else{var u=d.beforeCreate;d.beforeCreate=u?[].concat(u,c):[c]}return{exports:e,options:d}}r.d(t,"a",function(){return s})}}]);