(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{CHCY:function(e,t,s){"use strict";s.r(t);var i={data:function(){return{record:{id:"",type:"",asset_request_id:"",description:"",equipments:[]},types:[],equipments:[],records:[],errors:[],columns:["type","description","id"],columns_equipments:["check","asset.inventory_serial","asset.serial","asset.marca","asset.model"],selected:[],selectAll:!1,table_options:{rowClassCallback:function(e){var t=document.getElementById("checkbox_"+e.asset_id);return t&&t.checked?"selected-row cursor-pointer":"cursor-pointer"},headings:{type:"Tipo",description:"Descripción",id:"Acción","asset.inventory_serial":"Código","asset.serial":"Serial","asset.marca":"Marca","asset.model":"Modelo"},sortable:["type","asset.inventory_serial","asset.serial","asset.marca","asset.model"],filterable:["type","asset.inventory_serial","asset.serial","asset.marca","asset.model"]}}},props:{id:Number,state:String},methods:{toggleActive:function(e){var t=e.row,s=document.getElementById("checkbox_"+t.asset_id);if(s&&0==s.checked)(i=this.selected.indexOf(t.asset_id))>=0?this.selected.splice(i,1):s.click();else if(s&&1==s.checked){var i;(i=this.selected.indexOf(t.asset_id))>=0?s.click():this.selected.push(t.asset_id)}},select:function(){var e=this;e.selected=[],$.each(e.equipments,(function(t,s){var i=document.getElementById("checkbox_"+s.asset_id);e.selectAll?i&&i.checked&&i.click():e.selected.push(s.asset_id)}))},reset:function(){this.record={id:"",type:"",asset_request_id:"",description:"",equipments:[]}},createRecord:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this;if(!i.selected.length>0)return bootbox.alert("Debe agregar almenos un elemento a la solicitud"),!1;var a=document.querySelector("#files"),r=new FormData;if(i.errors=[],i.record.asset_request_id=i.id,i.record.equipments=i.selected,i.record.id)i.updateRecord(e);else{for(var o in i.loading=!0,i.record)"equipments"==o?r.append(o,JSON.stringify(i.record[o])):r.append(o,i.record[o]);for(var n=0;n<a.files.length;n++){var c=a.files[n];r.append("files["+n+"]",c)}axios.post("/"+e,r,{headers:{"Content-Type":"multipart/form-data"}}).then((function(a){void 0!==a.data.redirect?location.href=a.data.redirect:(i.errors=[],s&&i.reset(),t&&i.readRecords(e),i.loading=!1,i.showMessage("store"))})).catch((function(e){if(i.errors=[],void 0!==e.response)for(var t in e.response.data.errors)e.response.data.errors[t]&&i.errors.push(e.response.data.errors[t][0]);i.loading=!1}))}},getTypes:function(){var e=this;axios.get("/asset/get-request-types").then((function(t){e.types=t.data}))},getEquipments:function(){var e=this;axios.get("/asset/requests/get-equipments/"+this.id).then((function(t){e.equipments=t.data}))},viewMessage:function(){return this.showMessage("custom","Alerta","danger","screen-error","La solicitud está en un tramite que no le permite acceder a esta funcionalidad"),!1}},mounted:function(){var e=this;$("#add_event").on("show.bs.modal",(function(){e.reset(),e.getTypes(),e.getEquipments()}))},created:function(){}},a=s("KHd+"),r=Object(a.a)(i,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("a",{staticClass:"btn btn-success btn-xs btn-icon btn-action",attrs:{href:"#",title:"Registros de Eventos","data-toggle":"tooltip",disabled:"Aprobado"!=e.state&&"Pendiente por entrega"!=e.state},on:{click:function(t){"Aprobado"==e.state||"Pendiente por entrega"==e.state?e.addRecord("add_event","requests/request-event",t):e.viewMessage()}}},[s("i",{staticClass:"fa fa-list-alt"})]),e._v(" "),s("div",{staticClass:"modal fade text-left",attrs:{tabindex:"-1",role:"dialog",id:"add_event"}},[s("div",{staticClass:"modal-dialog vue-crud",attrs:{role:"document"}},[s("div",{staticClass:"modal-content"},[e._m(0),e._v(" "),s("div",{staticClass:"modal-body"},[e.errors.length>0?s("div",{staticClass:"alert alert-danger"},[s("div",{staticClass:"container"},[e._m(1),e._v(" "),s("strong",[e._v("Cuidado!")]),e._v(" Debe verificar los siguientes errores antes de continuar:\n\t\t\t\t\t\t\t\t"),s("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"alert","aria-label":"Close"},on:{click:function(t){t.preventDefault(),e.errors=[]}}},[e._m(2)]),e._v(" "),s("ul",e._l(e.errors,(function(t){return s("li",[e._v(e._s(t))])})),0)])]):e._e(),e._v(" "),s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-6"},[s("div",{staticClass:"form-group is-required"},[s("label",[e._v("Tipo de Evento:")]),e._v(" "),s("select2",{attrs:{options:e.types,"data-toggle":"tooltip",title:"Indique el tipo de evento ocurrido"},model:{value:e.record.type,callback:function(t){e.$set(e.record,"type",t)},expression:"record.type"}}),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.record.id,expression:"record.id"}],attrs:{type:"hidden"},domProps:{value:e.record.id},on:{input:function(t){t.target.composing||e.$set(e.record,"id",t.target.value)}}})],1)]),e._v(" "),s("div",{staticClass:"col-md-6"},[s("div",{staticClass:"form-group is-required"},[s("label",[e._v("Descripción del Evento")]),e._v(" "),s("ckeditor",{staticClass:"form-control",attrs:{editor:e.ckeditor.editor,id:"description_event","data-toggle":"tooltip",title:"Indique una descripción del evento",config:e.ckeditor.editorConfig,name:"description_event","tag-name":"textarea",rows:"3"},model:{value:e.record.description,callback:function(t){e.$set(e.record,"description",t)},expression:"record.description"}})],1)])]),e._v(" "),s("div",{staticClass:"row"},[s("div",{directives:[{name:"show",rawName:"v-show",value:2==e.record.type,expression:"record.type == 2"}],staticClass:"col-md-6"},[e._m(3)])]),e._v(" "),s("hr"),e._v(" "),s("div",{staticClass:"row"},[e._m(4),e._v(" "),s("div",{staticClass:"col-md-12"},[s("v-client-table",{ref:"tableevent",attrs:{columns:e.columns_equipments,data:e.equipments,options:e.table_options},on:{"row-click":e.toggleActive},scopedSlots:e._u([{key:"check",fn:function(t){return s("div",{staticClass:"text-center"},[s("label",{staticClass:"form-checkbox"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.selected,expression:"selected"}],staticClass:"cursor-pointer",attrs:{type:"checkbox",id:"checkbox_"+t.row.asset_id},domProps:{value:t.row.asset_id,checked:Array.isArray(e.selected)?e._i(e.selected,t.row.asset_id)>-1:e.selected},on:{change:function(s){var i=e.selected,a=s.target,r=!!a.checked;if(Array.isArray(i)){var o=t.row.asset_id,n=e._i(i,o);a.checked?n<0&&(e.selected=i.concat([o])):n>-1&&(e.selected=i.slice(0,n).concat(i.slice(n+1)))}else e.selected=r}}})])])}}])},[s("div",{staticClass:"text-center",attrs:{slot:"h__check"},slot:"h__check"},[s("label",{staticClass:"form-checkbox"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.selectAll,expression:"selectAll"}],staticClass:"cursor-pointer",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.selectAll)?e._i(e.selectAll,null)>-1:e.selectAll},on:{click:function(t){return e.select()},change:function(t){var s=e.selectAll,i=t.target,a=!!i.checked;if(Array.isArray(s)){var r=e._i(s,null);i.checked?r<0&&(e.selectAll=s.concat([null])):r>-1&&(e.selectAll=s.slice(0,r).concat(s.slice(r+1)))}else e.selectAll=a}}})])])])],1)])]),e._v(" "),s("div",{staticClass:"modal-body modal-table"},[s("hr"),e._v(" "),s("v-client-table",{attrs:{columns:e.columns,data:e.records,options:e.table_options},scopedSlots:e._u([{key:"type",fn:function(t){return s("div",{staticClass:"text-center"},e._l(e.types,(function(i){return s("div",[t.row.type==i.id?s("span",[e._v("\n\t\t\t\t\t\t\t\t\t\t"+e._s(i.text)+"\n\t\t\t\t\t\t\t\t\t")]):e._e()])})),0)}},{key:"id",fn:function(t){return s("div",{staticClass:"text-center"},[s("button",{staticClass:"btn btn-warning btn-xs btn-icon btn-action",attrs:{title:"Modificar registro","data-toggle":"tooltip",type:"button"},on:{click:function(s){return e.initUpdate(t.row.id,s)}}},[s("i",{staticClass:"fa fa-edit"})]),e._v(" "),s("button",{staticClass:"btn btn-danger btn-xs btn-icon btn-action",attrs:{title:"Eliminar registro","data-toggle":"tooltip",type:"button"},on:{click:function(s){return e.deleteRecord(t.row.id,"requests/request-event")}}},[s("i",{staticClass:"fa fa-trash-o"})])])}}])})],1),e._v(" "),s("div",{staticClass:"modal-footer"},[s("button",{staticClass:"btn btn-default btn-sm btn-round btn-modal-close",attrs:{type:"button","data-dismiss":"modal"}},[e._v("\n\t                \t\tCerrar\n\t                \t")]),e._v(" "),s("button",{staticClass:"btn btn-primary btn-sm btn-round btn-modal-save",attrs:{type:"button"},on:{click:function(t){return e.createRecord("asset/requests/request-event")}}},[e._v("\n\t                \t\tGuardar\n\t\t                ")])])])])])])}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"modal-header"},[t("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[t("span",{attrs:{"aria-hidden":"true"}},[this._v("×")])]),this._v(" "),t("h6",[t("i",{staticClass:"icofont icofont-tasks-alt ico-2x"}),this._v("\n\t\t\t\t\t\t\tNuevo Evento\n\t\t\t\t\t\t")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"alert-icon"},[t("i",{staticClass:"now-ui-icons objects_support-17"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("span",{attrs:{"aria-hidden":"true"}},[t("i",{staticClass:"now-ui-icons ui-1_simple-remove"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"form-group"},[t("label",[this._v(" Informe de especificaciones ")]),this._v(" "),t("input",{attrs:{id:"files",name:"files",type:"file",accept:".docx, .doc, .odt, .pdf",multiple:""}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"col-md-12"},[t("b",[this._v("Seleccione los equipos afectados")])])}],!1,null,null,null);t.default=r.exports}}]);